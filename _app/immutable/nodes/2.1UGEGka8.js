import"../chunks/NZTpNUN0.js";import{a as st,l as nt,o as Fe,b as He,d as it,e as _e,s as ot}from"../chunks/HsgcShGP.js";import{b as lt,h as M,d as dt,z as d,ak as ct,r as vt,e as ut,g as qe,i as Le,j as pe,m as Z,X as ft,_ as ht,k as $e,l as Be,p as _t,ay as ge,a2 as Ue,O as Ne,az as pt,au as gt,aA as Ge,aB as mt,aC as yt,a1 as xt,aD as bt,aE as wt,aF as St,aG as kt,Y as Ct,T as Mt,aH as Tt,aI as It,aJ as At,aK as Et,aL as Dt,u as qt,o as Lt,D as Ye,w as ze,F as xe,a as re,I as We,J as E,L as b,K as D,f as Nt,av as A,G as me,am as k,aw as Gt,aM as Rt,aN as Ot}from"../chunks/DzEooLPW.js";import{b as G,i as Pt}from"../chunks/ByxWkIbB.js";import{b as Vt}from"../chunks/CIJfLql8.js";function Ft(t,e){return e}function Ht(t,e,a,r){for(var s=[],o=e.length,u=0;u<o;u++)yt(e[u].e,s,!0);var _=o>0&&s.length===0&&a!==null;if(_){var f=a.parentNode;xt(f),f.append(a),r.clear(),F(t,e[0].prev,e[o-1].next)}bt(s,()=>{for(var y=0;y<o;y++){var i=e[y];_||(r.delete(i.k),F(t,i.prev,i.next)),wt(i.e,!_)}})}function $t(t,e,a,r,s,o=null){var u=t,_={flags:e,items:new Map,first:null};M&&dt();var f=null,y=!1,i=ct(()=>{var h=a();return Mt(h)?h:h==null?[]:Ue(h)});lt(()=>{var h=d(i),n=h.length;if(y&&n===0)return;y=n===0;let l=!1;if(M){var v=vt(u)===ut;v!==(n===0)&&(u=qe(),Le(u),pe(!1),l=!0)}if(M){for(var O=null,T,p=0;p<n;p++){if(Z.nodeType===ft&&Z.data===ht){u=Z,l=!0,pe(!1);break}var w=h[p],z=r(w,p);T=Xe(Z,_,O,null,w,z,p,s,e,a),_.items.set(z,T),O=T}n>0&&Le(qe())}M||Bt(h,_,u,s,e,r,a),o!==null&&(n===0?f?$e(f):f=Be(()=>o(u)):f!==null&&_t(f,()=>{f=null})),l&&pe(!0),d(i)}),M&&(u=Z)}function Bt(t,e,a,r,s,o,u){var _=t.length,f=e.items,y=e.first,i=y,h,n=null,l=[],v=[],O,T,p,w;for(w=0;w<_;w+=1){if(O=t[w],T=o(O,w),p=f.get(T),p===void 0){var z=i?i.e.nodes_start:a;n=Xe(z,e,n,n===null?e.first:n.next,O,T,w,r,s,u),f.set(T,n),l=[],v=[],i=n.next;continue}if(Ut(p,O,w),(p.e.f&ge)!==0&&$e(p.e),p!==i){if(h!==void 0&&h.has(p)){if(l.length<v.length){var H=v[0],q;n=H.prev;var I=l[0],$=l[l.length-1];for(q=0;q<l.length;q+=1)Re(l[q],H,a);for(q=0;q<v.length;q+=1)h.delete(v[q]);F(e,I.prev,$.next),F(e,n,I),F(e,$,H),i=H,n=$,w-=1,l=[],v=[]}else h.delete(p),Re(p,i,a),F(e,p.prev,p.next),F(e,p,n===null?e.first:n.next),F(e,n,p),n=p;continue}for(l=[],v=[];i!==null&&i.k!==T;)(i.e.f&ge)===0&&(h??=new Set).add(i),v.push(i),i=i.next;if(i===null)continue;p=i}l.push(p),n=p,i=p.next}if(i!==null||h!==void 0){for(var P=h===void 0?[]:Ue(h);i!==null;)(i.e.f&ge)===0&&P.push(i),i=i.next;var K=P.length;if(K>0){var j=null;Ht(e,P,j,f)}}Ne.first=e.first&&e.first.e,Ne.last=n&&n.e}function Ut(t,e,a,r){pt(t.v,e),t.i=a}function Xe(t,e,a,r,s,o,u,_,f,y){var i=(f&St)!==0,h=(f&kt)===0,n=i?h?gt(s,!1,!1):Ge(s):s,l=(f&mt)===0?u:Ge(u),v={i:l,v:n,k:o,a:null,e:null,prev:a,next:r};try{return v.e=Be(()=>_(t,n,l,y),M),v.e.prev=a&&a.e,v.e.next=r&&r.e,a===null?e.first=v:(a.next=v,a.e.next=v.e),r!==null&&(r.prev=v,r.e.prev=v.e),v}finally{}}function Re(t,e,a){for(var r=t.next?t.next.e.nodes_start:a,s=e?e.e.nodes_start:a,o=t.e.nodes_start;o!==r;){var u=Ct(o);s.before(o),o=u}}function F(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function Ke(t){var e,a,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(a=Ke(t[e]))&&(r&&(r+=" "),r+=a)}else for(a in t)t[a]&&(r&&(r+=" "),r+=a);return r}function Yt(){for(var t,e,a=0,r="",s=arguments.length;a<s;a++)(t=arguments[a])&&(e=Ke(t))&&(r&&(r+=" "),r+=e);return r}function zt(t){return typeof t=="object"?Yt(t):t??""}function Wt(t,e,a){var r=t==null?"":""+t;return r=r?r+" "+e:e,r===""?null:r}function Xt(t,e){return t==null?null:String(t)}function Kt(t,e,a,r,s,o){var u=t.__className;if(M||u!==a||u===void 0){var _=Wt(a,r);(!M||_!==t.getAttribute("class"))&&(_==null?t.removeAttribute("class"):t.className=_),t.__className=a}return o}function ye(t,e,a,r){var s=t.__style;if(M||s!==e){var o=Xt(e);(!M||o!==t.getAttribute("style"))&&(o==null?t.removeAttribute("style"):t.style.cssText=o),t.__style=e}return r}const Jt=Symbol("is custom element"),Qt=Symbol("is html");function Oe(t){if(M){var e=!1,a=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;m(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var s=t.checked;m(t,"checked",null),t.checked=s}}};t.__on_r=a,Dt(a),st()}}function m(t,e,a,r){var s=Zt(t);M&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=a)&&(e==="loading"&&(t[Tt]=a),a==null?t.removeAttribute(e):typeof a!="string"&&jt(t).includes(e)?t[e]=a:t.setAttribute(e,a))}function Zt(t){return t.__attributes??={[Jt]:t.nodeName.includes("-"),[Qt]:t.namespaceURI===It}}var Pe=new Map;function jt(t){var e=Pe.get(t.nodeName);if(e)return e;Pe.set(t.nodeName,e=[]);for(var a,r=t,s=Element.prototype;s!==r;){a=Et(r);for(var o in a)a[o].set&&e.push(o);r=At(r)}return e}function Ve(t,e,a=e){nt(t,"change",r=>{var s=r?t.defaultChecked:t.checked;a(s)}),(M&&t.defaultChecked!==t.checked||qt(e)==null)&&a(t.checked),Lt(()=>{var r=e();t.checked=!!r})}class Je{inputCanvas;outputCanvi;props;defaultProps={width:30,tint:[255,0,0],dirn:1,targetGrey:200};constructor(e,a,r){this.inputCanvas=e,this.outputCanvi=a??[e],this.props={...this.defaultProps,...r}}_update(){this.props.targetGrey+=this.props.dirn*2,this.props.targetGrey>255&&(this.props.targetGrey=0),this.props.targetGrey<0&&(this.props.dirn=1)}_draw(e=!0){const a=this.inputCanvas.getContext("2d");if(!(a&&e))return;const r=this.inputCanvas.width,s=this.inputCanvas.height,o=a.getImageData(0,0,r,s);for(let u=0;u<r;u++)for(let _=0;_<s;_++){const f=4*(u+_*r),y=o.data[f+0],i=Math.pow(Math.abs(this.props.targetGrey-y)/this.props.width,.3);if(i<=1){for(let h=0;h<3;h++)o.data[f+h]=this.props.tint[h]*(1-i)+o.data[f+0]*i;o.data[f+3]=255*(1-i)}else o.data[f+3]=0}for(const u of this.outputCanvi)u?.getContext("2d")?.putImageData(o,0,0)}updateAndDraw(e=!0){this._update(),this._draw(e)}}function ea(t,e,a,r=0){const s=t.getContext("2d"),o=e.getContext("2d");if(!(s&&o&&a.length>0))return;const u=s.getImageData(0,0,t.width,t.height),_=a[0];for(let f=0;f<t.width;f++)for(let y=0;y<t.height;y++){const i=4*(f+y*t.width),h=(u.data[i+0]/255+r)%1,n=Math.min(Math.floor(h*a.length),a.length-1);if(!a.at(n)){console.warn(`couldnt get framecache at index ${n}, only have ${a.length}`);continue}if(i+0>a[n].data.length){console.warn(`somehow our data array is too small? ${a[n].data.length} {p}`);continue}for(let l=0;l<4;l++)_.data[i+l]=a[n].data[i+l]}o.putImageData(_,0,0)}var ta=xe('<div><canvas class="logo svelte-1gv2h0l"></canvas> <canvas class="shimmer svelte-1gv2h0l"></canvas></div>');function aa(t,e){Ye(e,!0);let a,r;const s=350,o=150;function u(){const n=a.getContext("2d");if(!n)return;const l=n.createLinearGradient(0,0,s,0);l.addColorStop(0,"black"),l.addColorStop(1,"white");const v=n.createLinearGradient(s,0,0,0);v.addColorStop(0,"black"),v.addColorStop(1,"white"),n.fillStyle=l,n.fillRect(0,0,s,o),n.fillStyle=v,n.fillRect(0,o/2,s,o/2),n.fontStretch="expanded",n.font=[o*.4+"px","Monospace"].join(" "),n.textAlign="center",n.textBaseline="middle",n.fillStyle=v,n.fillText("TEMPORAL",s/2,o/4),n.fillStyle=l,n.fillText("SMUDGING",s/2,3*o/4)}ze(()=>{u()});let _,f;Fe(()=>{_=new Je(a,[r]),f=setInterval(()=>{u(),_.updateAndDraw()},15)}),He(()=>{clearInterval(f)});var y=ta();ye(y,"width: 350px; height: 150px; position:relative;");var i=E(y);m(i,"width",s),m(i,"height",o),G(i,n=>a=n,()=>a);var h=b(i,2);m(h,"width",s),m(h,"height",o),G(h,n=>r=n,()=>r),D(y),re(t,y),We()}class R{x;y;constructor(e,a){this.x=e??0,this.y=a??0}static from(e){return new R(e[0],e[1])}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(e){return e.x===this.x&&e.y===this.y}clone(){return new R(this.x,this.y)}normalize(){const e=this.magnitude();return e>0?this.mulS(1/e):this.clone()}add(e){return new R(this.x+e.x,this.y+e.y)}subtract(e){return new R(this.x-e.x,this.y-e.y)}mulS(e){return new R(this.x*e,this.y*e)}round(){return new R(Math.round(this.x),Math.round(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}toString(){return this.x+","+this.y}static angleBetween(e,a){const r=e.dot(a),s=e.cross(a);return r===0?s>0?Math.PI/2:-Math.PI/2:s===0?0:Math.acos(r/(e.magnitude()*a.magnitude()))*Math.sign(s)}}var ra=(t,e,a,r)=>{d(e)==="Eyedropper"&&k(a,d(r)*255)},sa=Ot('<circle fill="#0000"></circle>'),na=(t,e,a)=>{e(d(a))},ia=xe("<button> </button>"),oa=(t,e)=>e(t),la=xe('<!> <div class="ui_container svelte-1fydq5b"><div class="video_column svelte-1fydq5b"><div class="header_video_canvas svelte-1fydq5b">Video Source</div> <video class="video_embed svelte-1fydq5b" autoplay playsinline="" controls></video> <div class="header_video_canvas svelte-1fydq5b">Video Source sampled from smudged time</div> <div class="video_box svelte-1fydq5b"><canvas class="canvas svelte-1fydq5b"></canvas> <canvas class="canvas_as_overlay svelte-1fydq5b"></canvas></div></div> <div class="video_column svelte-1fydq5b"><div class="header_video_canvas svelte-1fydq5b">Time-per-pixel in Source</div> <canvas class="canvas svelte-1fydq5b"></canvas> <div class="header_video_canvas svelte-1fydq5b">Here is where you Smudge Time</div> <div class="video_box svelte-1fydq5b" style="cursor:none;"><canvas class="canvas_w_overlay svelte-1fydq5b"></canvas> <canvas class="canvas_as_overlay svelte-1fydq5b"></canvas> <svg class="svg_parent svelte-1fydq5b" xmlns="http://www.w3.org/2000/svg"><!></svg></div></div> <div class="video_column palette svelte-1fydq5b"><button class="inactive svelte-1fydq5b" title="Current Paint Gray"></button> <!></div></div> <canvas class="hidden_canvas svelte-1fydq5b"></canvas> <input style="display:none" type="file" accept="video/*"/> <div><label for="shimmerCheck">Time Shimmer</label> <input type="checkbox" id="shimmerCheck"/></div> <div><label for="temporalOffsetCheck">Temporal Offset Mode?</label> <input type="checkbox" id="temporalOffsetCheck"/></div> <div>Source code <a href="https://github.com/dustinfreeman/temporal-smudging">here</a></div>',3);function ha(t,e){Ye(e,!0);const a=[];let r=A(!1),s,o,u,_,f,y=A(void 0),i=A(void 0),h=Gt(()=>[d(y),d(i)]);const n=1/5,l=1920*n,v=1080*n,T=Vt+"/example_videos/"+"WIN_20250614_19_54_33_Pro.mp4";let p=A(T),w;function z(c){let g=new FileReader;g.readAsDataURL(c.target.files[0]),g.onload=S=>{let x=S.target.result??"";k(p,x,!0),a.length=0,k(r,!1),s.play()}}const H=["Paint This","Eyedropper","Darken","Lighten","Smudge","Load Video"],q=["ðŸ’…","ðŸ”Ž","ðŸŒ˜","ðŸŒ”","ðŸ‘…","ðŸ—ƒï¸"];let I=A("Paint This");function $(c){return`rgb(${c}, ${c}, ${c})`}let P=A(0),K=A(!1);ze(()=>{console.log("video?",s),s?.requestVideoFrameCallback(j)});const j=(c,g)=>{const S=o?.getContext("2d"),x=u?.getContext("2d");if(S&&x&&s){if(d(r))s.playbackRate=1;else{s.playbackRate=2,S.drawImage(s,0,0,l,v);let X=S.getImageData(0,0,l,v);a.push(X)}s.duration>=0&&(k(P,s.currentTime/s.duration),x.fillStyle=$(d(P)*255),x.fillRect(0,0,l,v)),s?.requestVideoFrameCallback(j)}};let B=A(30),ee=A(128),se,C=A(void 0);const Qe=c=>{let g=f.getContext("2d");if(k(C,new R(c.offsetX,c.offsetY),!0),se&&g&&c.buttons===1){const S=d(C).subtract(se);let x=g.getImageData(0,0,l,v);if(d(I)==="Paint This"&&(g.strokeStyle="",g.fillStyle=$(d(ee)),g.lineWidth=d(B),g.beginPath(),g.arc(d(C).x,d(C).y,d(B),0,2*Math.PI),g.fill()),["Darken","Lighten"].includes(d(I))){const X=1*(d(I)==="Lighten"?1:-1);for(let L=0;L<l;L++)for(let N=0;N<v;N++){const fe=new R(L,N);if(d(C).subtract(fe).magnitude()<d(B)){const Y=4*(L+N*l);for(let V=0;V<3;V++)x.data[Y+V]=Math.max(0,Math.min(255,x.data[Y+V]+X));x.data[Y+3]=255}}g.putImageData(x,0,0)}if(d(I)==="Eyedropper"&&k(ee,x.data[4*d(C).x+d(C).y*l],!0),d(I)==="Smudge"){for(let L=0;L<l;L++)for(let N=0;N<v;N++){const fe=new R(L,N),Y=4*(L+N*l),V=4*(L-S.x+(N-S.y)*l);if(d(C).subtract(fe).magnitude()<d(B)&&0<=V&&V<=4*l*v){const rt=Math.floor(x.data[Y+0]*.7+x.data[V+0]*.3);for(let he=0;he<3;he++)x.data[Y+he]=rt;x.data[Y+3]=255}}g.putImageData(x,0,0)}}se=d(C)};function Ze(c){k(B,Math.min(Math.max(1,d(B)+c.deltaY*.02),150),!0)}let be,ne=A(!0),we;Fe(()=>{be=new Je(f,d(h),{width:60}),we=setInterval(()=>{be.updateAndDraw(d(ne)),ea(f,_,a,d(K)?d(P):0)},15)}),He(()=>{clearInterval(we)});function je(c){if(c==="Load Video"){w.click();return}k(I,c,!0)}var Se=la(),ke=Nt(Se);aa(ke,{});var ie=b(ke,2),oe=E(ie),W=b(E(oe),2);ye(W,"aspect-ratio: 1.7777777777777777;"),W.muted=!0,G(W,c=>s=c,()=>s);var Ce=b(W,4),J=E(Ce);m(J,"width",l),m(J,"height",v),J.__mousemove=c=>{c.offsetX/l,_.getContext("2d")},G(J,c=>_=c,()=>_);var le=b(J,2);m(le,"width",l),m(le,"height",v),G(le,c=>k(i,c),()=>d(i)),D(Ce),D(oe);var de=b(oe,2),Q=b(E(de),2);m(Q,"width",l),m(Q,"height",v),Q.__click=[ra,I,ee,P],G(Q,c=>u=c,()=>u);var Me=b(Q,4),U=E(Me);m(U,"width",l),m(U,"height",v),U.__mousemove=Qe,G(U,c=>f=c,()=>f);var te=b(U,2);m(te,"width",l),m(te,"height",v),G(te,c=>k(y,c),()=>d(y));var ce=b(te,2);m(ce,"viewBox","0 0 384 216");var et=E(ce);{var tt=c=>{var g=sa();m(g,"stroke","#00f6"),m(g,"stroke-width",l*.009),me(()=>{m(g,"cx",d(C).x),m(g,"cy",d(C).y),m(g,"r",d(B))}),re(c,g)};Pt(et,c=>{d(C)&&c(tt)})}D(ce),D(Me),D(de);var Te=b(de,2),Ie=E(Te),at=b(Ie,2);$t(at,17,()=>H,Ft,(c,g)=>{var S=ia();S.__click=[na,je,g];var x=E(S,!0);D(S),me(X=>{Kt(S,1,zt(d(I)===d(g)?"button_mode_on":"palette_button"),"svelte-1fydq5b"),m(S,"title",d(g)),ot(x,X)},[()=>q[H.indexOf(d(g))]]),re(c,S)}),D(Te),D(ie);var ae=b(ie,2);m(ae,"width",l),m(ae,"height",v),G(ae,c=>o=c,()=>o);var ve=b(ae,2);ve.__change=[oa,z],G(ve,c=>w=c,()=>w);var ue=b(ve,2),Ae=b(E(ue),2);Oe(Ae),D(ue);var Ee=b(ue,2),De=b(E(Ee),2);Oe(De),D(Ee),Rt(2),me(c=>{m(W,"src",d(p)),ye(Ie,`background-color: ${c??""};`)},[()=>$(d(ee))]),_e("ended",W,()=>{d(r)||console.log(`video playthrough ended; framecache size: ${a.length}`),k(r,!0),s.play()}),_e("wheel",U,Ze),_e("mouseleave",U,()=>{k(C,void 0)}),Ve(Ae,()=>d(ne),c=>k(ne,c)),Ve(De,()=>d(K),c=>k(K,c)),re(t,Se),We()}it(["mousemove","click","change"]);export{ha as component};
