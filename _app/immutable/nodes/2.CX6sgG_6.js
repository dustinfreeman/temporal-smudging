import"../chunks/NZTpNUN0.js";import{l as st,o as qe,a as Ue,d as nt,e as _e,s as it}from"../chunks/D84_kZ6H.js";import{d as ot,h as E,i as lt,V as o,as as dt,r as ct,j as ut,k as Oe,s as Pe,l as me,o as te,C as vt,a9 as ft,m as We,n as Ye,p as ht,aG as ye,ad as Xe,a3 as Ve,aH as gt,aC as pt,aI as Ne,aJ as _t,aK as mt,ac as yt,aL as wt,I as xt,aM as bt,aN as Ct,z as Mt,a6 as St,v as kt,u as It,Y as xe,Q as Je,J as be,b as ae,Z as Ce,_ as T,K as x,a0 as D,aO as Ke,M as oe,f as Tt,aD as M,au as C,aE as Dt,aP as At}from"../chunks/CdWPQDNH.js";import{s as m,r as He}from"../chunks/BqVRJ_Ik.js";import{b as R,i as Et}from"../chunks/J2ejWl2E.js";import{b as zt}from"../chunks/WbwLUaCS.js";function Gt(a,e){return e}function Lt(a,e,t,r){for(var s=[],l=e.length,c=0;c<l;c++)mt(e[c].e,s,!0);var g=l>0&&s.length===0&&t!==null;if(g){var f=t.parentNode;yt(f),f.append(t),r.clear(),B(a,e[0].prev,e[l-1].next)}wt(s,()=>{for(var _=0;_<l;_++){var i=e[_];g||(r.delete(i.k),B(a,i.prev,i.next)),xt(i.e,!g)}})}function Rt(a,e,t,r,s,l=null){var c=a,g={flags:e,items:new Map,first:null};E&&lt();var f=null,_=!1,i=dt(()=>{var h=t();return St(h)?h:h==null?[]:Xe(h)});ot(()=>{var h=o(i),n=h.length;if(_&&n===0)return;_=n===0;let d=!1;if(E){var v=ct(c)===ut;v!==(n===0)&&(c=Oe(),Pe(c),me(!1),d=!0)}if(E){for(var P=null,S,p=0;p<n;p++){if(te.nodeType===vt&&te.data===ft){c=te,d=!0,me(!1);break}var b=h[p],X=r(b,p);S=Qe(te,g,P,null,b,X,p,s,e,t),g.items.set(X,S),P=S}n>0&&Pe(Oe())}E||Ot(h,g,c,s,e,r,t),l!==null&&(n===0?f?We(f):f=Ye(()=>l(c)):f!==null&&ht(f,()=>{f=null})),d&&me(!0),o(i)}),E&&(c=te)}function Ot(a,e,t,r,s,l,c){var g=a.length,f=e.items,_=e.first,i=_,h,n=null,d=[],v=[],P,S,p,b;for(b=0;b<g;b+=1){if(P=a[b],S=l(P,b),p=f.get(S),p===void 0){var X=i?i.e.nodes_start:t;n=Qe(X,e,n,n===null?e.first:n.next,P,S,b,r,s,c),f.set(S,n),d=[],v=[],i=n.next;continue}if(Pt(p,P,b),(p.e.f&ye)!==0&&We(p.e),p!==i){if(h!==void 0&&h.has(p)){if(d.length<v.length){var F=v[0],z;n=F.prev;var k=d[0],q=d[d.length-1];for(z=0;z<d.length;z+=1)Be(d[z],F,t);for(z=0;z<v.length;z+=1)h.delete(v[z]);B(e,k.prev,q.next),B(e,n,k),B(e,q,F),i=F,n=q,b-=1,d=[],v=[]}else h.delete(p),Be(p,i,t),B(e,p.prev,p.next),B(e,p,n===null?e.first:n.next),B(e,n,p),n=p;continue}for(d=[],v=[];i!==null&&i.k!==S;)(i.e.f&ye)===0&&(h??=new Set).add(i),v.push(i),i=i.next;if(i===null)continue;p=i}d.push(p),n=p,i=p.next}if(i!==null||h!==void 0){for(var V=h===void 0?[]:Xe(h);i!==null;)(i.e.f&ye)===0&&V.push(i),i=i.next;var K=V.length;if(K>0){var re=null;Lt(e,V,re,f)}}Ve.first=e.first&&e.first.e,Ve.last=n&&n.e}function Pt(a,e,t,r){gt(a.v,e),a.i=t}function Qe(a,e,t,r,s,l,c,g,f,_){var i=(f&bt)!==0,h=(f&Ct)===0,n=i?h?pt(s,!1,!1):Ne(s):s,d=(f&_t)===0?c:Ne(c),v={i:d,v:n,k:l,a:null,e:null,prev:t,next:r};try{return v.e=Ye(()=>g(a,n,d,_),E),v.e.prev=t&&t.e,v.e.next=r&&r.e,t===null?e.first=v:(t.next=v,t.e.next=v.e),r!==null&&(r.prev=v,r.e.prev=v.e),v}finally{}}function Be(a,e,t){for(var r=a.next?a.next.e.nodes_start:t,s=e?e.e.nodes_start:t,l=a.e.nodes_start;l!==r;){var c=Mt(l);s.before(l),l=c}}function B(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ze(a){var e,t,r="";if(typeof a=="string"||typeof a=="number")r+=a;else if(typeof a=="object")if(Array.isArray(a)){var s=a.length;for(e=0;e<s;e++)a[e]&&(t=Ze(a[e]))&&(r&&(r+=" "),r+=t)}else for(t in a)a[t]&&(r&&(r+=" "),r+=t);return r}function Vt(){for(var a,e,t=0,r="",s=arguments.length;t<s;t++)(a=arguments[t])&&(e=Ze(a))&&(r&&(r+=" "),r+=e);return r}function Nt(a){return typeof a=="object"?Vt(a):a??""}function Ht(a,e,t){var r=a==null?"":""+a;return r=r?r+" "+e:e,r===""?null:r}function Bt(a,e){return a==null?null:String(a)}function Ft(a,e,t,r,s,l){var c=a.__className;if(E||c!==t||c===void 0){var g=Ht(t,r);(!E||g!==a.getAttribute("class"))&&(g==null?a.removeAttribute("class"):a.className=g),a.__className=t}return l}function we(a,e,t,r){var s=a.__style;if(E||s!==e){var l=Bt(e);(!E||l!==a.getAttribute("style"))&&(l==null?a.removeAttribute("style"):a.style.cssText=l),a.__style=e}return r}function Fe(a,e,t=e){st(a,"change",r=>{var s=r?a.defaultChecked:a.checked;t(s)}),(E&&a.defaultChecked!==a.checked||kt(e)==null)&&t(a.checked),It(()=>{var r=e();a.checked=!!r})}class $e{inputCanvas;outputCanvi;props;defaultProps={width:30,tint:[255,0,0],dirn:1,targetGrey:200};constructor(e,t,r){this.inputCanvas=e,this.outputCanvi=t??[e],this.props={...this.defaultProps,...r}}_update(){this.props.targetGrey+=this.props.dirn*2,this.props.targetGrey>255&&(this.props.targetGrey=0),this.props.targetGrey<0&&(this.props.dirn=1)}_draw(e=!0){const t=this.inputCanvas.getContext("2d");if(!(t&&e))return;const r=this.inputCanvas.width,s=this.inputCanvas.height,l=t.getImageData(0,0,r,s);for(let c=0;c<r;c++)for(let g=0;g<s;g++){const f=4*(c+g*r),_=l.data[f+0],i=Math.pow(Math.abs(this.props.targetGrey-_)/this.props.width,.3);if(i<=1){for(let h=0;h<3;h++)l.data[f+h]=this.props.tint[h]*(1-i)+l.data[f+0]*i;l.data[f+3]=255*(1-i)}else l.data[f+3]=0}for(const c of this.outputCanvi)c?.getContext("2d")?.putImageData(l,0,0)}updateAndDraw(e=!0){this._update(),this._draw(e)}}function qt(a,e,t,r=0){const s=a.getContext("2d"),l=e.getContext("2d");if(!(s&&l&&t.length>0))return;const c=s.getImageData(0,0,a.width,a.height),g=t[0];for(let f=0;f<a.width;f++)for(let _=0;_<a.height;_++){const i=4*(f+_*a.width),h=(c.data[i+0]/255+r)%1,n=Math.min(Math.floor(h*t.length),t.length-1);if(!t.at(n)){console.warn(`couldnt get framecache at index ${n}, only have ${t.length}`);continue}if(i+0>t[n].data.length){console.warn(`somehow our data array is too small? ${t[n].data.length} {p}`);continue}for(let d=0;d<4;d++)g.data[i+d]=t[n].data[i+d]}l.putImageData(g,0,0)}var Ut=be('<div><canvas class="logo svelte-1gv2h0l"></canvas> <canvas class="shimmer svelte-1gv2h0l"></canvas></div>');function Wt(a,e){xe(e,!0);let t,r;const s=350,l=150;function c(){const n=t.getContext("2d");if(!n)return;const d=n.createLinearGradient(0,0,s,0);d.addColorStop(0,"black"),d.addColorStop(1,"white");const v=n.createLinearGradient(s,0,0,0);v.addColorStop(0,"black"),v.addColorStop(1,"white"),n.fillStyle=d,n.fillRect(0,0,s,l),n.fillStyle=v,n.fillRect(0,l/2,s,l/2),n.fontStretch="expanded",n.font=[l*.4+"px","Monospace"].join(" "),n.textAlign="center",n.textBaseline="middle",n.fillStyle=v,n.fillText("TEMPORAL",s/2,l/4),n.fillStyle=d,n.fillText("SMUDGING",s/2,3*l/4)}Je(()=>{c()});let g,f;qe(()=>{g=new $e(t,[r]),f=setInterval(()=>{c(),g.updateAndDraw()},15)}),Ue(()=>{clearInterval(f)});var _=Ut();we(_,"width: 350px; height: 150px; position:relative;");var i=T(_);m(i,"width",s),m(i,"height",l),R(i,n=>t=n,()=>t);var h=x(i,2);m(h,"width",s),m(h,"height",l),R(h,n=>r=n,()=>r),D(_),ae(a,_),Ce()}class A{x;y;constructor(e,t){this.x=e??0,this.y=t??0}static from(e){return new A(e[0],e[1])}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(e){return e.x===this.x&&e.y===this.y}clone(){return new A(this.x,this.y)}normalize(){const e=this.magnitude();return e>0?this.mulS(1/e):this.clone()}add(e){return new A(this.x+e.x,this.y+e.y)}subtract(e){return new A(this.x-e.x,this.y-e.y)}mulS(e){return new A(this.x*e,this.y*e)}round(){return new A(Math.round(this.x),Math.round(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}toString(){return this.x+","+this.y}static angleBetween(e,t){const r=e.dot(t),s=e.cross(t);return r===0?s>0?Math.PI/2:-Math.PI/2:s===0?0:Math.acos(r/(e.magnitude()*t.magnitude()))*Math.sign(s)}}var Yt=Ke('<circle fill="#0000"></circle>'),Xt=Ke('<svg class="svg_parent svelte-n74vpk" xmlns="http://www.w3.org/2000/svg"><!></svg>');function Jt(a,e){xe(e,!0);var t=Xt(),r=T(t);{var s=l=>{var c=Yt();m(c,"stroke","#00f6"),oe(()=>{m(c,"cx",e.centroid.x),m(c,"cy",e.centroid.y),m(c,"r",e.radius),m(c,"stroke-width",e.CW*.009)}),ae(l,c)};Et(r,l=>{e.centroid&&l(s)})}D(t),oe(()=>m(t,"viewBox",`0 0 ${e.CW??""} ${e.CH??""}`)),ae(a,t),Ce()}var Kt=(a,e,t,r)=>{o(e)==="Eyedropper"&&(C(t,o(r)*255),console.log("Eyedropper",o(r),o(t)))},Qt=(a,e,t)=>{e(o(t))},Zt=be("<button> </button>"),$t=(a,e)=>e(a),jt=be('<!> <div class="ui_container svelte-5wsy3z"><div class="video_column svelte-5wsy3z"><div class="header_video_canvas svelte-5wsy3z">Video Source</div> <video class="video_embed svelte-5wsy3z" autoplay playsinline="" controls></video> <div class="header_video_canvas svelte-5wsy3z">Video Source sampled from smudged time</div> <div class="video_box svelte-5wsy3z"><canvas class="canvas svelte-5wsy3z"></canvas> <canvas class="canvas_as_overlay svelte-5wsy3z"></canvas></div></div> <div class="video_column svelte-5wsy3z"><div class="header_video_canvas svelte-5wsy3z">Time-per-pixel in Source</div> <canvas class="canvas svelte-5wsy3z"></canvas> <div class="header_video_canvas svelte-5wsy3z">Here is where you Smudge Time</div> <div class="video_box svelte-5wsy3z" style="cursor:crosshair;"><canvas class="canvas_w_overlay svelte-5wsy3z"></canvas> <canvas class="canvas_as_overlay svelte-5wsy3z"></canvas> <!></div></div> <div class="video_column palette svelte-5wsy3z"><button class="inactive svelte-5wsy3z" title="Current Paint Gray"></button> <!></div></div> <canvas class="hidden_canvas svelte-5wsy3z"></canvas> <input style="display:none" type="file" accept="video/*"/> <div><label for="shimmerCheck">Time Shimmer</label> <input type="checkbox" id="shimmerCheck"/></div> <div><label for="temporalOffsetCheck">Temporal Offset Mode?</label> <input type="checkbox" id="temporalOffsetCheck"/></div> <div>Source code <a href="https://github.com/dustinfreeman/temporal-smudging">here</a></div>',3);function ia(a,e){xe(e,!0);const t=[];let r=M(!1),s,l,c,g,f,_=M(void 0),i=M(void 0),h=Dt(()=>[o(_),o(i)]);const n=1/4,d=1920*n,v=1080*n,S=zt+"/example_videos/"+"Arteles-Pepper/Arteles-Pepper-2025-11-17-07.04.mov";let p=M(S),b;function X(u){let w=new FileReader;w.readAsDataURL(u.target.files[0]),w.onload=y=>{let O=y.target.result??"";C(p,O,!0),t.length=0,C(r,!1),s.play()}}const F=["Paint This","Eyedropper","Darken","Lighten","Smudge","Load Video"],z=["ðŸ’…","ðŸ”Ž","ðŸŒ˜","ðŸŒ”","ðŸ‘…","ðŸ—ƒï¸"];let k=M("Eyedropper");function q(u){return`rgb(${u}, ${u}, ${u})`}let V=M(0),K=M(!1);Je(()=>{console.log("video?",s),s?.requestVideoFrameCallback(re)});const re=(u,w)=>{const y=l?.getContext("2d"),O=c?.getContext("2d");if(y&&O&&s){if(o(r))s.playbackRate=1;else{s.playbackRate=2,y.drawImage(s,0,0,d,v);let W=y.getImageData(0,0,d,v);t.push(W)}s.duration>=0&&(C(V,s.currentTime/s.duration),O.fillStyle=q(o(V)*255),O.fillRect(0,0,d,v)),s?.requestVideoFrameCallback(re)}};let U=M(d/12),se=M(128),Q=M(void 0),I=M(void 0);const Me=u=>{let w=f.getContext("2d");if(!w)return;let y=w.getImageData(0,0,d,v);const O=j=>{const ee=u.currentTarget.getBoundingClientRect();return new A(Math.floor(j.x/ee.width*d),Math.floor(j.y/ee.height*v))};o(Q),C(Q,new A(u.offsetX,u.offsetY),!0);let W=o(I);if(C(I,O(o(Q)),!0),W&&w&&u.buttons===1){const j=o(I).subtract(W);if(o(k)==="Paint This"&&(w.strokeStyle="",w.fillStyle=q(o(se)),w.lineWidth=o(U),w.beginPath(),w.arc(o(I).x,o(I).y,o(U),0,2*Math.PI),w.fill()),["Darken","Lighten"].includes(o(k))){const ee=1*(o(k)==="Lighten"?1:-1);for(let G=0;G<d;G++)for(let L=0;L<v;L++){const ge=new A(G,L);if(o(I).subtract(ge).magnitude()<o(U)){const Y=4*(G+L*d);for(let H=0;H<3;H++)y.data[Y+H]=Math.max(0,Math.min(255,y.data[Y+H]+ee));y.data[Y+3]=255}}w.putImageData(y,0,0)}if(o(k)==="Eyedropper"&&C(se,y.data[4*(o(I).x+o(I).y*d)],!0),o(k)==="Smudge"){for(let G=0;G<d;G++)for(let L=0;L<v;L++){const ge=new A(G,L),Y=4*(G+L*d),H=4*(G-j.x+(L-j.y)*d);if(o(I).subtract(ge).magnitude()<o(U)&&0<=H&&H<=4*d*v){const rt=Math.floor(y.data[Y+0]*.7+y.data[H+0]*.3);for(let pe=0;pe<3;pe++)y.data[Y+pe]=rt;y.data[Y+3]=255}}w.putImageData(y,0,0)}}o(Q),W=o(I)};function je(u){C(U,Math.min(Math.max(1,o(U)+u.deltaY*.02),150),!0)}let Se,le=M(!0),ke;qe(()=>{Se=new $e(f,o(h),{width:60}),ke=setInterval(()=>{Se.updateAndDraw(o(le)),qt(f,g,t,o(K)?o(V):0)},15)}),Ue(()=>{clearInterval(ke)});function et(u){if(u==="Load Video"){b.click();return}C(k,u,!0)}var Ie=jt(),Te=Tt(Ie);Wt(Te,{});var de=x(Te,2),ce=T(de),J=x(T(ce),2);we(J,"aspect-ratio: 1.7777777777777777;"),J.muted=!0,R(J,u=>s=u,()=>s);var De=x(J,4),Z=T(De);m(Z,"width",d),m(Z,"height",v),Z.__mousemove=u=>{u.offsetX/d,g.getContext("2d")},R(Z,u=>g=u,()=>g);var ue=x(Z,2);m(ue,"width",d),m(ue,"height",v),R(ue,u=>C(i,u),()=>o(i)),D(De),D(ce);var ve=x(ce,2),$=x(T(ve),2);m($,"width",d),m($,"height",v),$.__click=[Kt,k,se,V],R($,u=>c=u,()=>c);var Ae=x($,4),N=T(Ae);m(N,"width",d),m(N,"height",v),N.__mousemove=Me,N.__mousedown=Me,R(N,u=>f=u,()=>f);var ne=x(N,2);m(ne,"width",d),m(ne,"height",v),R(ne,u=>C(_,u),()=>o(_));var tt=x(ne,2);Jt(tt,{get centroid(){return o(I)},get radius(){return o(U)},CW:d,CH:v}),D(Ae),D(ve);var Ee=x(ve,2),ze=T(Ee),at=x(ze,2);Rt(at,17,()=>F,Gt,(u,w)=>{var y=Zt();y.__click=[Qt,et,w];var O=T(y,!0);D(y),oe(W=>{Ft(y,1,Nt(o(k)===o(w)?"button_mode_on":"palette_button"),"svelte-5wsy3z"),m(y,"title",o(w)),it(O,W)},[()=>z[F.indexOf(o(w))]]),ae(u,y)}),D(Ee),D(de);var ie=x(de,2);m(ie,"width",d),m(ie,"height",v),R(ie,u=>l=u,()=>l);var fe=x(ie,2);fe.__change=[$t,X],R(fe,u=>b=u,()=>b);var he=x(fe,2),Ge=x(T(he),2);He(Ge),D(he);var Le=x(he,2),Re=x(T(Le),2);He(Re),D(Le),At(2),oe(u=>{m(J,"src",o(p)),we(ze,`background-color: ${u??""};`)},[()=>q(o(se))]),_e("ended",J,()=>{o(r)||console.log(`video playthrough ended; framecache size: ${t.length}`),C(r,!0),s.play()}),_e("wheel",N,je),_e("mouseleave",N,()=>{C(Q,void 0)}),Fe(Ge,()=>o(le),u=>C(le,u)),Fe(Re,()=>o(K),u=>C(K,u)),ae(a,Ie),Ce()}nt(["mousemove","click","mousedown","change"]);export{ia as component};
