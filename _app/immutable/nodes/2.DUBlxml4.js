import"../chunks/NZTpNUN0.js";import{a as st,l as nt,o as He,b as Ve,d as it,e as ge,s as lt}from"../chunks/6rkeRXEO.js";import{b as ot,h as M,d as ct,z as c,ak as dt,r as vt,e as ht,g as Le,i as Ge,j as _e,m as Z,X as ut,_ as ft,k as Be,l as Ue,p as gt,ay as me,a2 as We,O as Ne,az as _t,au as mt,aA as Re,aB as pt,aC as yt,a1 as xt,aD as wt,aE as kt,aF as bt,aG as St,Y as Ct,T as Mt,aH as It,aI as Tt,aJ as At,aK as Dt,aL as Et,u as Lt,o as Gt,D as qe,w as Ye,F as xe,a as re,I as ze,J as D,L as w,K as E,f as Nt,av as A,G as pe,am as S,aw as Rt,aM as Ot}from"../chunks/hT4ctJEh.js";import{b as R,i as Pt}from"../chunks/CARgINIg.js";import{b as Ft}from"../chunks/DYdypyeS.js";function $t(t,e){return e}function Ht(t,e,a,r){for(var s=[],i=e.length,u=0;u<i;u++)yt(e[u].e,s,!0);var f=i>0&&s.length===0&&a!==null;if(f){var v=a.parentNode;xt(v),v.append(a),r.clear(),H(t,e[0].prev,e[i-1].next)}wt(s,()=>{for(var y=0;y<i;y++){var l=e[y];f||(r.delete(l.k),H(t,l.prev,l.next)),kt(l.e,!f)}})}function Vt(t,e,a,r,s,i=null){var u=t,f={flags:e,items:new Map,first:null};M&&ct();var v=null,y=!1,l=dt(()=>{var g=a();return Mt(g)?g:g==null?[]:We(g)});ot(()=>{var g=c(l),n=g.length;if(y&&n===0)return;y=n===0;let o=!1;if(M){var h=vt(u)===ht;h!==(n===0)&&(u=Le(),Ge(u),_e(!1),o=!0)}if(M){for(var P=null,I,_=0;_<n;_++){if(Z.nodeType===ut&&Z.data===ft){u=Z,o=!0,_e(!1);break}var k=g[_],Y=r(k,_);I=Xe(Z,f,P,null,k,Y,_,s,e,a),f.items.set(Y,I),P=I}n>0&&Ge(Le())}M||Bt(g,f,u,s,e,r,a),i!==null&&(n===0?v?Be(v):v=Ue(()=>i(u)):v!==null&&gt(v,()=>{v=null})),o&&_e(!0),c(l)}),M&&(u=Z)}function Bt(t,e,a,r,s,i,u){var f=t.length,v=e.items,y=e.first,l=y,g,n=null,o=[],h=[],P,I,_,k;for(k=0;k<f;k+=1){if(P=t[k],I=i(P,k),_=v.get(I),_===void 0){var Y=l?l.e.nodes_start:a;n=Xe(Y,e,n,n===null?e.first:n.next,P,I,k,r,s,u),v.set(I,n),o=[],h=[],l=n.next;continue}if(Ut(_,P,k),(_.e.f&me)!==0&&Be(_.e),_!==l){if(g!==void 0&&g.has(_)){if(o.length<h.length){var V=h[0],L;n=V.prev;var T=o[0],B=o[o.length-1];for(L=0;L<o.length;L+=1)Oe(o[L],V,a);for(L=0;L<h.length;L+=1)g.delete(h[L]);H(e,T.prev,B.next),H(e,n,T),H(e,B,V),l=V,n=B,k-=1,o=[],h=[]}else g.delete(_),Oe(_,l,a),H(e,_.prev,_.next),H(e,_,n===null?e.first:n.next),H(e,n,_),n=_;continue}for(o=[],h=[];l!==null&&l.k!==I;)(l.e.f&me)===0&&(g??=new Set).add(l),h.push(l),l=l.next;if(l===null)continue;_=l}o.push(_),n=_,l=_.next}if(l!==null||g!==void 0){for(var F=g===void 0?[]:We(g);l!==null;)(l.e.f&me)===0&&F.push(l),l=l.next;var K=F.length;if(K>0){var j=null;Ht(e,F,j,v)}}Ne.first=e.first&&e.first.e,Ne.last=n&&n.e}function Ut(t,e,a,r){_t(t.v,e),t.i=a}function Xe(t,e,a,r,s,i,u,f,v,y){var l=(v&bt)!==0,g=(v&St)===0,n=l?g?mt(s,!1,!1):Re(s):s,o=(v&pt)===0?u:Re(u),h={i:o,v:n,k:i,a:null,e:null,prev:a,next:r};try{return h.e=Ue(()=>f(t,n,o,y),M),h.e.prev=a&&a.e,h.e.next=r&&r.e,a===null?e.first=h:(a.next=h,a.e.next=h.e),r!==null&&(r.prev=h,r.e.prev=h.e),h}finally{}}function Oe(t,e,a){for(var r=t.next?t.next.e.nodes_start:a,s=e?e.e.nodes_start:a,i=t.e.nodes_start;i!==r;){var u=Ct(i);s.before(i),i=u}}function H(t,e,a){e===null?t.first=a:(e.next=a,e.e.next=a&&a.e),a!==null&&(a.prev=e,a.e.prev=e&&e.e)}function Ke(t){var e,a,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(a=Ke(t[e]))&&(r&&(r+=" "),r+=a)}else for(a in t)t[a]&&(r&&(r+=" "),r+=a);return r}function Wt(){for(var t,e,a=0,r="",s=arguments.length;a<s;a++)(t=arguments[a])&&(e=Ke(t))&&(r&&(r+=" "),r+=e);return r}function qt(t){return typeof t=="object"?Wt(t):t??""}function Yt(t,e,a){var r=t==null?"":""+t;return r=r?r+" "+e:e,r===""?null:r}function zt(t,e){return t==null?null:String(t)}function Xt(t,e,a,r,s,i){var u=t.__className;if(M||u!==a||u===void 0){var f=Yt(a,r);(!M||f!==t.getAttribute("class"))&&(f==null?t.removeAttribute("class"):t.className=f),t.__className=a}return i}function ye(t,e,a,r){var s=t.__style;if(M||s!==e){var i=zt(e);(!M||i!==t.getAttribute("style"))&&(i==null?t.removeAttribute("style"):t.style.cssText=i),t.__style=e}return r}const Kt=Symbol("is custom element"),Jt=Symbol("is html");function Pe(t){if(M){var e=!1,a=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var r=t.value;p(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var s=t.checked;p(t,"checked",null),t.checked=s}}};t.__on_r=a,Et(a),st()}}function p(t,e,a,r){var s=Qt(t);M&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=a)&&(e==="loading"&&(t[It]=a),a==null?t.removeAttribute(e):typeof a!="string"&&Zt(t).includes(e)?t[e]=a:t.setAttribute(e,a))}function Qt(t){return t.__attributes??={[Kt]:t.nodeName.includes("-"),[Jt]:t.namespaceURI===Tt}}var Fe=new Map;function Zt(t){var e=Fe.get(t.nodeName);if(e)return e;Fe.set(t.nodeName,e=[]);for(var a,r=t,s=Element.prototype;s!==r;){a=Dt(r);for(var i in a)a[i].set&&e.push(i);r=At(r)}return e}function $e(t,e,a=e){nt(t,"change",r=>{var s=r?t.defaultChecked:t.checked;a(s)}),(M&&t.defaultChecked!==t.checked||Lt(e)==null)&&a(t.checked),Gt(()=>{var r=e();t.checked=!!r})}class Je{getCanvas;drawCanvi;shimmerWidth;shimmerDirn=1;targetShimmerGray=200;constructor(e,a,r=30){this.getCanvas=e,this.drawCanvi=a??[e],this.shimmerWidth=r}_update(){this.targetShimmerGray+=this.shimmerDirn*2,this.targetShimmerGray>255&&(this.targetShimmerGray=0),this.targetShimmerGray<0&&(this.shimmerDirn=1)}_draw(e=!0){const a=this.getCanvas.getContext("2d");if(!(a&&e))return;const r=this.getCanvas.width,s=this.getCanvas.height,i=a.getImageData(0,0,r,s);for(let u=0;u<r;u++)for(let f=0;f<s;f++){const v=4*(u+f*r),y=i.data[v+0],l=Math.pow(Math.abs(this.targetShimmerGray-y)/this.shimmerWidth,.3);l<=1?(i.data[v+0]=255*(1-l)+i.data[v+0]*l,i.data[v+1]=0+i.data[v+1]*l,i.data[v+2]=0+i.data[v+2]*l,i.data[v+3]=255*(1-l)):i.data[v+3]=0}for(const u of this.drawCanvi)u?.getContext("2d")?.putImageData(i,0,0)}updateAndDraw(e=!0){this._update(),this._draw(e)}}function jt(t,e,a,r=0){const s=t.getContext("2d"),i=e.getContext("2d");if(!(s&&i&&a.length>0))return;const u=s.getImageData(0,0,t.width,t.height),f=a[0];for(let v=0;v<t.width;v++)for(let y=0;y<t.height;y++){const l=4*(v+y*t.width),g=(u.data[l+0]/255+r)%1,n=Math.min(Math.floor(g*a.length),a.length-1);if(!a.at(n)){console.warn(`couldnt get framecache at index ${n}, only have ${a.length}`);continue}if(l+0>a[n].data.length){console.warn(`somehow our data array is too small? ${a[n].data.length} {p}`);continue}for(let o=0;o<4;o++)f.data[l+o]=a[n].data[l+o]}i.putImageData(f,0,0)}var ea=xe('<div><canvas class="logo svelte-1gv2h0l"></canvas> <canvas class="shimmer svelte-1gv2h0l"></canvas></div>');function ta(t,e){qe(e,!0);let a,r;const s=350,i=150;function u(){const n=a.getContext("2d");if(!n)return;const o=n.createLinearGradient(0,0,s,0);o.addColorStop(0,"black"),o.addColorStop(1,"white");const h=n.createLinearGradient(s,0,0,0);h.addColorStop(0,"black"),h.addColorStop(1,"white"),n.fillStyle=o,n.fillRect(0,0,s,i),n.fillStyle=h,n.fillRect(0,i/2,s,i/2),n.fontStretch="expanded",n.font=[i*.4+"px","Monospace"].join(" "),n.textAlign="center",n.textBaseline="middle",n.fillStyle=h,n.fillText("TEMPORAL",s/2,i/4),n.fillStyle=o,n.fillText("SMUDGING",s/2,3*i/4)}Ye(()=>{u()});let f,v;He(()=>{f=new Je(a,[r]),v=setInterval(()=>{u(),f.updateAndDraw()},15)}),Ve(()=>{clearInterval(v)});var y=ea();ye(y,"width: 350px; height: 150px; position:relative;");var l=D(y);p(l,"width",s),p(l,"height",i),R(l,n=>a=n,()=>a);var g=w(l,2);p(g,"width",s),p(g,"height",i),R(g,n=>r=n,()=>r),E(y),re(t,y),ze()}class O{x;y;constructor(e,a){this.x=e??0,this.y=a??0}static from(e){return new O(e[0],e[1])}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(e){return e.x===this.x&&e.y===this.y}clone(){return new O(this.x,this.y)}normalize(){const e=this.magnitude();return e>0?this.mulS(1/e):this.clone()}add(e){return new O(this.x+e.x,this.y+e.y)}subtract(e){return new O(this.x-e.x,this.y-e.y)}mulS(e){return new O(this.x*e,this.y*e)}round(){return new O(Math.round(this.x),Math.round(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}toString(){return this.x+","+this.y}static angleBetween(e,a){const r=e.dot(a),s=e.cross(a);return r===0?s>0?Math.PI/2:-Math.PI/2:s===0?0:Math.acos(r/(e.magnitude()*a.magnitude()))*Math.sign(s)}}var aa=(t,e,a,r)=>{c(e)==="Eyedropper"&&S(a,c(r)*255)},ra=Ot('<circle fill="#0000"></circle>'),sa=(t,e,a)=>{e(c(a))},na=xe("<button> </button>"),ia=(t,e)=>e(t),la=xe('<!> <div class="ui_container svelte-11h6gkt"><div class="video_column svelte-11h6gkt"><video class="video_embed svelte-11h6gkt" autoplay playsinline="" controls></video> <div class="video_box svelte-11h6gkt"><canvas class="canvas svelte-11h6gkt"></canvas> <canvas class="canvas_as_overlay svelte-11h6gkt"></canvas></div></div> <div class="video_column svelte-11h6gkt"><canvas class="canvas svelte-11h6gkt"></canvas> <div class="video_box svelte-11h6gkt" style="cursor:none;"><canvas class="canvas_w_overlay svelte-11h6gkt"></canvas> <canvas class="canvas_as_overlay svelte-11h6gkt"></canvas> <svg class="svg_parent svelte-11h6gkt" xmlns="http://www.w3.org/2000/svg"><!></svg></div></div> <div class="video_column palette svelte-11h6gkt"><button class="inactive svelte-11h6gkt" title="Current Paint Gray"></button> <!></div></div> <canvas class="hidden_canvas svelte-11h6gkt"></canvas> <input style="display:none" type="file" accept="video/*"/> <div><label for="shimmerCheck">Time Shimmer</label> <input type="checkbox" id="shimmerCheck"/></div> <div><label for="temporalOffsetCheck">Temporal Offset Mode?</label> <input type="checkbox" id="temporalOffsetCheck"/></div>',3);function ua(t,e){qe(e,!0);const a=[];let r=A(!1),s,i,u,f,v,y=A(void 0),l=A(void 0),g=Rt(()=>[c(y),c(l)]);const n=1/5,o=1920*n,h=1080*n,I=Ft+"/example_videos/"+"WIN_20250614_19_54_33_Pro.mp4";let _=A(I),k;function Y(d){let m=new FileReader;m.readAsDataURL(d.target.files[0]),m.onload=b=>{let x=b.target.result??"";S(_,x,!0),a.length=0,S(r,!1),s.play()}}const V=["Paint This","Eyedropper","Darken","Lighten","Smudge","Load Video"],L=["ðŸ’…","ðŸ”Ž","ðŸŒ˜","ðŸŒ”","ðŸ‘…","ðŸ—ƒï¸"];let T=A("Paint This");function B(d){return`rgb(${d}, ${d}, ${d})`}let F=A(0),K=A(!1);Ye(()=>{console.log("video?",s),s?.requestVideoFrameCallback(j)});const j=(d,m)=>{const b=i?.getContext("2d"),x=u?.getContext("2d");if(b&&x&&s){if(c(r))s.playbackRate=1;else{s.playbackRate=2,b.drawImage(s,0,0,o,h);let X=b.getImageData(0,0,o,h);a.push(X)}s.duration>=0&&(S(F,s.currentTime/s.duration),x.fillStyle=B(c(F)*255),x.fillRect(0,0,o,h)),s?.requestVideoFrameCallback(j)}};let U=A(30),ee=A(128),se,C=A(void 0);const Qe=d=>{let m=v.getContext("2d");if(S(C,new O(d.offsetX,d.offsetY),!0),se&&m&&d.buttons===1){const b=c(C).subtract(se);let x=m.getImageData(0,0,o,h);if(c(T)==="Paint This"&&(m.strokeStyle="",m.fillStyle=B(c(ee)),m.lineWidth=c(U),m.beginPath(),m.arc(c(C).x,c(C).y,c(U),0,2*Math.PI),m.fill()),["Darken","Lighten"].includes(c(T))){const X=1*(c(T)==="Lighten"?1:-1);for(let G=0;G<o;G++)for(let N=0;N<h;N++){const ue=new O(G,N);if(c(C).subtract(ue).magnitude()<c(U)){const q=4*(G+N*o);for(let $=0;$<3;$++)x.data[q+$]=Math.max(0,Math.min(255,x.data[q+$]+X));x.data[q+3]=255}}m.putImageData(x,0,0)}if(c(T)==="Eyedropper"&&S(ee,x.data[4*c(C).x+c(C).y*o],!0),c(T)==="Smudge"){for(let G=0;G<o;G++)for(let N=0;N<h;N++){const ue=new O(G,N),q=4*(G+N*o),$=4*(G-b.x+(N-b.y)*o);if(c(C).subtract(ue).magnitude()<c(U)&&0<=$&&$<=4*o*h){const rt=Math.floor(x.data[q+0]*.7+x.data[$+0]*.3);for(let fe=0;fe<3;fe++)x.data[q+fe]=rt;x.data[q+3]=255}}m.putImageData(x,0,0)}}se=c(C)};function Ze(d){S(U,Math.min(Math.max(1,c(U)+d.deltaY*.02),150),!0)}let we,ne=A(!0),ke;He(()=>{we=new Je(v,c(g),60),ke=setInterval(()=>{we.updateAndDraw(c(ne)),jt(v,f,a,c(K)?c(F):0)},15)}),Ve(()=>{clearInterval(ke)});function je(d){if(d==="Load Video"){k.click();return}S(T,d,!0)}var be=la(),Se=Nt(be);ta(Se,{});var ie=w(Se,2),le=D(ie),z=D(le);ye(z,"aspect-ratio: 1.7777777777777777;"),z.muted=!0,R(z,d=>s=d,()=>s);var Ce=w(z,2),J=D(Ce);p(J,"width",o),p(J,"height",h),J.__mousemove=d=>{d.offsetX/o,f.getContext("2d")},R(J,d=>f=d,()=>f);var oe=w(J,2);p(oe,"width",o),p(oe,"height",h),R(oe,d=>S(l,d),()=>c(l)),E(Ce),E(le);var ce=w(le,2),Q=D(ce);p(Q,"width",o),p(Q,"height",h),Q.__click=[aa,T,ee,F],R(Q,d=>u=d,()=>u);var Me=w(Q,2),W=D(Me);p(W,"width",o),p(W,"height",h),W.__mousemove=Qe,R(W,d=>v=d,()=>v);var te=w(W,2);p(te,"width",o),p(te,"height",h),R(te,d=>S(y,d),()=>c(y));var de=w(te,2);p(de,"viewBox","0 0 384 216");var et=D(de);{var tt=d=>{var m=ra();p(m,"stroke","#00f6"),p(m,"stroke-width",o*.009),pe(()=>{p(m,"cx",c(C).x),p(m,"cy",c(C).y),p(m,"r",c(U))}),re(d,m)};Pt(et,d=>{c(C)&&d(tt)})}E(de),E(Me),E(ce);var Ie=w(ce,2),Te=D(Ie),at=w(Te,2);Vt(at,17,()=>V,$t,(d,m)=>{var b=na();b.__click=[sa,je,m];var x=D(b,!0);E(b),pe(X=>{Xt(b,1,qt(c(T)===c(m)?"button_mode_on":"palette_button"),"svelte-11h6gkt"),p(b,"title",c(m)),lt(x,X)},[()=>L[V.indexOf(c(m))]]),re(d,b)}),E(Ie),E(ie);var ae=w(ie,2);p(ae,"width",o),p(ae,"height",h),R(ae,d=>i=d,()=>i);var ve=w(ae,2);ve.__change=[ia,Y],R(ve,d=>k=d,()=>k);var he=w(ve,2),Ae=w(D(he),2);Pe(Ae),E(he);var De=w(he,2),Ee=w(D(De),2);Pe(Ee),E(De),pe(d=>{p(z,"src",c(_)),ye(Te,`background-color: ${d??""};`)},[()=>B(c(ee))]),ge("ended",z,()=>{c(r)||console.log(`video playthrough ended; framecache size: ${a.length}`),S(r,!0),s.play()}),ge("wheel",W,Ze),ge("mouseleave",W,()=>{S(C,void 0)}),$e(Ae,()=>c(ne),d=>S(ne,d)),$e(Ee,()=>c(K),d=>S(K,d)),re(t,be),ze()}it(["mousemove","click","change"]);export{ua as component};
